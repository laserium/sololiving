<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sololiving.domain.article.mapper.ArticleViewMapper">

    <!-- 전체 게시글 목록 조회 -->
    <select id="selectAllArticlesList" resultType="com.sololiving.domain.article.dto.response.ViewArticleResponseICDto$ViewAllArticlesListResponseDto">
        SELECT 
            ROW_NUMBER() OVER (ORDER BY created_at DESC) AS displayNumber,
            article_id AS articleId,
            writer,
            title,
            content,
            category_code AS categoryCodes,
            like_cnt AS likeCnt,
            view_cnt AS viewCnt,
            created_at AS createdAt
        FROM ARTICLE
        ORDER BY created_at DESC
    </select>

    <!-- 게시글 목록 조회 -->
    <select id="selectArticlesByCategoryId" resultType="com.sololiving.domain.article.dto.response.ViewArticleResponseICDto$ViewArticlesListResponseDto">
        SELECT 
            ROW_NUMBER() OVER (ORDER BY created_at DESC) AS displayNumber,
            article_id AS articleId,
            writer,
            title,
            content,
            like_cnt AS likeCnt,
            view_cnt AS viewCnt,
            created_at AS createdAt
        FROM ARTICLE
        WHERE category_code = #{categoryCode}
        ORDER BY created_at DESC
        LIMIT 10 OFFSET #{page}
    </select>

     <!-- 게시글 상세 조회 -->
    <select id="selectByArticleId" resultType="com.sololiving.domain.article.dto.response.ViewArticleResponseICDto$ViewArticleDetailsResponseDto">
        SELECT
            article_id AS articleId,
            writer,
            title,
            content,
            category_code AS categoryCode,
            like_cnt AS likeCnt,
            view_cnt AS viewCnt,
            score,
            status,
            created_at AS createdAt,
            updated_at AS updatedAt
        FROM ARTICLE
        WHERE article_id = #{articleId}
    </select>
    
    <!-- 메인 페이지 : 일주일간 인기 게시글 TOP 5 조회 -->
    <select id="selectPopularArticleListInMain" resultType="com.sololiving.domain.article.dto.response.ViewArticleResponseICDto$ViewTopArticlesResponseDto">
        SELECT
            article_id AS articleId,
            writer,
            title,
            like_cnt AS likeCnt,
            view_cnt AS viewCnt,
            created_at AS createdAt,
            score AS score
        FROM ARTICLE
        WHERE created_at BETWEEN DATE_SUB(NOW(), INTERVAL 7 DAY) AND NOW()
        AND like_cnt &gt;= 10
        ORDER BY score DESC
        LIMIT 5
    </select>


    <!-- 메인 페이지 : 대표 카테고리의 게시글 목록 조회 -->
    <select id="selectArticlesListInMain" resultType="com.sololiving.domain.article.dto.response.ViewArticleResponseICDto$ViewCategoryArticlesResponseDto">
        SELECT
            article_id AS articleId,
            writer,
            title,
            like_cnt AS likeCnt,
            view_cnt AS viewCnt,
            created_at AS createdAt
        FROM ARTICLE
        WHERE category_code = #{categoryCode}
        ORDER BY created_at DESC
        LIMIT 5
    </select>

</mapper>
